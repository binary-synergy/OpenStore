@inherits NBrightBuy.render.NBrightBuyRazorTokens<NBrightRazor>
@inherits NBrightBuy.render.NBrightBuyRazorTokens<NBrightRazor>
@using System.Linq
@using NBrightCore.common
@using NBrightDNN
@using Nevoweb.DNN.NBrightBuy.Components;
@using Newtonsoft.Json;
@using DotNetNuke.Entities.Portals;
@using DotNetNuke.Entities.Modules;

@AddMetaData("resourcepath", "/DesktopModules/NBright/NBrightBuy/App_LocalResources/")

<!-- "pageheaderdetail.cshtml" template will be auto injected as dynamic data into page head section -->
@{
    // assign Model, so we can resolve var in VS
    var product = (ProductData)Model.List.First();
    var info = (NBrightInfo)product.Info;
    var navigationdata = new NavigationData(PortalSettings.Current.PortalId, Model.GetSetting("modref"));
    var entryUrl = EntryUrl(navigationdata, info, Model);
    PortalModuleBase pm = new PortalModuleBase();
    bool isBroker = pm.UserInfo.IsInRole("Brokers");
    bool isReseller = pm.UserInfo.IsInRole("Reseller");
    var tabid = StoreSettings.Current.ProductListTabId;
}
<script>
    $(document).ready(function () {
        $('#dnn_contentPane [id*="_titleLabel"]').text('@(product.ProductName)');
    });
</script>

<div style="margin-left: 20px; margin-right: 20px">
    <div class="eds_box eds_box_2">
        <div class="addedtobasket" style="display:none;">@ResourceKey("ProductView.addedtobasket")</div>
        <h1 style="text-align: center;">@(product.ProductName)</h1>
        <div class="categorybreadcrumbscenter">@CategoryBreadCrumb(true, Model)</div>
    </div>

    <div class="eds_box eds_box_2">
        <div class="row">
            <div class="col-sm-4 eds_box eds_box_2">
                @*Images*@
                @if (product.Imgs.Count > 0)
                {
                    <img class="img-fluid img-thumbnail" src="@ProductImageUrl(info, 300, 300)" alt="@(product.Imgs.First().GetXmlProperty("genxml/textbox/txtimagedesc"))" id="mainimage" />

                    if (@product.Imgs.Count >= 1)
                    {
                        <div class="row text-center text-lg-left">
                            @{
                                var lp = 1;
                                foreach (var img in product.Imgs)
                                {
                                    if (product.Imgs.Count > 1)
                                    {
                                        <div class="image@(lp.ToString()) col-lg-3 col-md-4 col-6">

                                            <a class="d-block mb-4 h-100" href="javascript:void(0)" title="@(img.GetXmlProperty("genxml/textbox/txtimagedesc"))">

                                                <img class="img-fluid img-thumbnail" src="@ProductImageUrl(info, 90, 90, lp)" alt="@(img.GetXmlProperty("genxml/textbox/txtimagedesc"))" onclick="showImage('@ProductImageUrl(info, 0, 0, lp, "&imgtype=png")', '@(img.GetXmlProperty("genxml/textbox/txtimagedesc"))');">

                                            </a>

                                        </div>
                                    }
                                    lp += 1;
                                }
                            }
                        </div>

                        <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
                            <a class="addthis_button_facebook"></a>
                            <a class="addthis_button_twitter"></a>
                            <a class="addthis_button_linkedin"></a>
                            <a class="addthis_button_google_plusone_share"></a>
                            <a class="addthis_button_pinterest_share"></a>
                            <a class="addthis_button_compact"></a>
                            <a class="addthis_counter addthis_bubble_style"></a>
                        </div>
                        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5124ab9460a8bb79"></script>
                    }
                }
                else
                {
                    <div class="noimage">
                        <i class="fa fa-picture-o"></i>
                    </div>
                }
            </div>

            <div class="col-sm-8 eds_box eds_box_2">
                @*Summary*@
                <div class="purchasing entryid@(info.ItemID)">
                    <input id="@(info.ItemID)_productid" type="hidden" value="@(info.ItemID)">
                    <input id="@(info.ItemID)_uilang" type="hidden" value="@(info.Lang)">

                    <div style="float: right">
                        @*<a href="@EntryReturnUrl(Model)" class="actionbutton absec"><i class="fa fa-reply"></i>@ResourceKey("ProductView.return")</a>*@
                        <a class="eds_btn eds_btn" href="javascript:history.back()">Back</a>
                    </div>

                    <h2>@info.GetXmlProperty("genxml/textbox/manufacturer")</h2>

                    @if (@info.GetXmlProperty("genxml/lang/genxml/textbox/txtsummary") != "")
                    {
                        <div class="summary">@BreakOf(info, "genxml/lang/genxml/textbox/txtsummary")</div>
                    }
                    @if (!@info.GetXmlPropertyBool("genxml/checkbox/chkcheckbox98"))
                    {
                        <div class="" style="font-size: 16px; line-height: 20px;">
                            Part Number : @info.GetXmlProperty("genxml/textbox/txtproductref")<br />
                        </div>
                    }

                    <div class="EmailForPrice" style="font-size: 16px; line-height: 20px; font-weight: bold;"> For prices: call +44 (0)118 945 3737 or <a href="mailto:sales@vjtech.co.uk?subject=Price request - @(product.ProductName)&amp;body=Please inform me of the price of the @(product.ProductName) at @PortalSettings.Current.PortalAlias.HTTPAlias on this page: @PortalSettings.Current.PortalAlias.HTTPAlias/@entryUrl">Email us</a> </div>
                    @if (@info.GetXmlPropertyBool("genxml/checkbox/chkcheckbox99"))
                    {
                        <div class="Reference Row">
                            <div class="Value" style="font-size: 16px; line-height: 20px">
                                <strong><span style="text-decoration: underline;">Note</span>:</strong>The displayed image shows the basic VJT Product with some additional accessories
                            </div>
                        </div>
                    }

                    @if (@info.GetXmlProperty("genxml/lang/genxml/edt/txtedit4") != "")
                    {
                        @*<div class="summary">@BreakOf(info, "genxml/lang/genxml/textbox/txtsummary")</div>*@
                        <div class="summary">@HtmlOf(info, "genxml/lang/genxml/edt/txtedit4")</div>
                    }

                    <div>
                        @HtmlOf(product.Info, "genxml/lang/genxml/hidden/promodesc")
                    </div>

                    @*Standards*@
                    <div class="eds_box eds_box_2" style="position: absolute; bottom: 20px; width: 95%;">
                        @if (product.HasProperty("BSEN"))
                        {<div class="eds_btn eds_btnInfo">BS EN</div>}
                        @if (product.HasProperty("BS"))
                        {<div class="eds_btn eds_btnInfo">BS</div>}
                        @if (product.HasProperty("ASTM"))
                        {<div class="eds_btn eds_btnInfo">ASTM</div>}
                        @if (product.HasProperty("XP"))
                        {<div class="eds_btn eds_btnInfo">XP</div>}
                        @if (product.HasProperty("AS"))
                        {<div class="eds_btn eds_btnInfo">AS</div>}
                        @if (product.HasProperty("FR"))
                        {<div class="eds_btn eds_btnInfo">FR</div>}
                        @if (product.HasProperty("GEOSPEC"))
                        {<div class="eds_btn eds_btnInfo">GEOSPEC</div>}
                        @if (product.HasProperty("GEOSPEC"))
                        {<div class="eds_btn eds_btnInfo">GEOSPEC</div>}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="eds_box eds_box_2">

        <div id="tabs" class="col-sm-12 productdetail">
            @*Tabs*@
            <ul class="nav-tabs">
                @if (info.GetXmlProperty("genxml/lang/genxml/edt/description") != "")
                {
                    <li class="tab-active"><a href="#tab-1">@ResourceKey("ProductView.description")</a></li><!-- Product description -->
                }
                @if (info.GetXmlProperty("genxml/lang/genxml/edt/txtedit") != "")
                {
                    <li><a href="#tab-2">@ResourceKey("ProductView.specification")</a></li>
                }
                @if (product.Docs.Count >= 1)
                {
                    <li><a href="#tab-3">@ResourceKey("ProductView.documentation")</a></li><!-- Document downloads -->
                }
                @if (product.Models.Count > 1)
                {
                    <li><a href="#tab-4">@ResourceKey("ProductView.models")</a></li>
                }
                @*@if (info.GetXmlProperty("genxml/lang/genxml/edt/txtedit4") != "")
                    {
                        <li><a href="#tab-4">@ResourceKey("ProductView.additionalsummary")</a></li>
                    }*@

                @if (@product.GetRelatedProducts().Count >= 1)
                {
                    <li><a href="#tab-5">@ResourceKey("ProductView.relatedproducts")</a></li>
                }

                <li><a href="#tab-6">@ResourceKey("ProductView.videos")</a></li>

                @if (isBroker)
                {
                    <li><a href="#tab-7">@ResourceKey("ProductView.firmware")</a></li>
                }
                @if (isBroker || isReseller)
                {
                    <li><a href="#tab-8">@ResourceKey("ProductView.userguides")</a></li>
                }

            </ul>
            @if (@info.GetXmlProperty("genxml/lang/genxml/edt/description") != "")
            {
                <div id="tab-1" class="tab-content tab-active">
                    <h2>@(product.ProductName)</h2>
                    @HtmlOf(info, "genxml/lang/genxml/edt/description")
                </div>
            }
            @if (@info.GetXmlProperty("genxml/lang/genxml/edt/txtedit") != "")
            {
                <div id="tab-2" class="tab-content tab-hide">
                    <h2>Detailed product specifications</h2>
                    @HtmlOf(info, "genxml/lang/genxml/edt/txtedit")
                </div>
            }
            @if (@product.Docs.Count >= 1)
            {
                var uData = new UserData();
                <div id="tab-3" class="tab-content tab-hide">
                    <div class="documents">
                        <table>
                            <tbody>
                                @foreach (var doc in product.Docs)
                                {
                                    if (!doc.GetXmlPropertyBool("genxml/checkbox/chkpurchase") || (uData.HasPurchasedDocByFileName(doc.GetXmlProperty("genxml/hidden/filename"))))
                                    {

                                        <tr><td><i class='fa fa-file-pdf-o fa-lg'></i><a href='/DesktopModules/NBright/NBrightBuy/XmlConnector.ashx?cmd=docdownload&downloadname=@doc.GetXmlProperty("genxml/textbox/txtfilename")&filename=@doc.GetXmlProperty("genxml/hidden/filerelpath")' title='@doc.GetXmlProperty("genxml/textbox/txtdocdesc")'>@doc.GetXmlProperty("genxml/textbox/txttitle")</a></td></tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }
            @if (@product.Models.Count > 1)
            {
                <div id="tab-4" class="tab-content tab-hide">
                    <div class="models">
                        <table>
                            <tbody>
                                <!-- Model list -->
                                @foreach (var m in product.Models)
                                {
                                    if (!m.GetXmlPropertyBool("genxml/checkbox/chkishidden") && !m.GetXmlPropertyBool("genxml/checkbox/chkdeleted"))
                                    {
                                        <tr>
                                            <td class="models-option">@m.GetXmlProperty("genxml/lang/genxml/textbox/txtmodelname")</td><!-- Model Name -->
                                            <td>@ResourceKey("ProductView.model")<text> </text>@m.GetXmlProperty("genxml/textbox/txtmodelref")</td>
                                            <td>
                                                @if (m.GetXmlPropertyDouble("genxml/textbox/txtsaleprice") > 0)
                                                {
                                                    <span class="old">@NBrightBuyUtils.FormatToStoreCurrency(m.GetXmlPropertyDouble("genxml/textbox/txtunitcost"))</span>
                                                    <strong>@NBrightBuyUtils.FormatToStoreCurrency(m.GetXmlPropertyDouble("genxml/textbox/txtsaleprice"))</strong>
                                                }
                                                else
                                                {
                                                    <span>@NBrightBuyUtils.FormatToStoreCurrency(m.GetXmlPropertyDouble("genxml/textbox/txtunitcost"))</span>
                                                }
                                            </td>
                                            <td class="models-value">
                                                @if (m.GetXmlPropertyBool("genxml/checkbox/chkstockon") && (m.GetXmlPropertyDouble("genxml/textbox/txtqtyremaining") <= m.GetXmlPropertyDouble("genxml/textbox/txtqtyminstock")))
                                                {
                                                    <strong>@ResourceKey("ProductView.outofstock")</strong>
                                                    if (m.GetXmlProperty("genxml/lang/genxml/textbox/txtextra") != "")
                                                    {
                                                        <span> - </span>
                                                        <span>@m.GetXmlProperty("genxml/lang/genxml/textbox/txtextra")</span>
                                                    }
                                                }
                                                @if (m.GetXmlProperty("genxml/lang/genxml/textbox/txtextra") != "")
                                                {
                                                    <span>@m.GetXmlProperty("genxml/lang/genxml/textbox/txtextra")</span>
                                                }
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }
            @*@if (@info.GetXmlProperty("genxml/lang/genxml/edt/txtedit4") != "")
                {
                    <div id="tab-4" class="tab-content tab-hide">
                        @HtmlOf(info, "genxml/lang/genxml/edt/txtedit4")
                    </div>
                }*@
            @if (@product.GetRelatedProducts().Count >= 1)
            {
                <div id="tab-5" class="tab-content tab-hide">
                    <div class="h2-headline">
                        @*@ResourceKey("ProductView.recommend")*@
                        <h2>Accessorize your purchase with these related items</h2>
                    </div>
                    <div id="relatedwrapper" class="productlist">
                        <!-- Related products -->
                        @foreach (var rp in product.GetRelatedProducts())
                        {
                            var rproduct = new ProductData(rp.ItemID, rp.Lang);
                            <div class="product">

                                <div class="productimg">

                                    @if (rp.GetXmlProperty("genxml/imgs/genxml[1]/hidden/imageurl") != "")
                                    {
                                        <div class="image">
                                            <img title="@(info.GetXmlProperty("genxml/lang/genxml/textbox/txtsummary"))" src="@ProductImageUrl(rp, 160, 0)">
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="noimage">
                                            @(Model.GetSettingHtmlOf("noimageicon"))
                                        </div>
                                    }
                                </div>

                                <div class="description">
                                    <h2><a href="@EntryUrl(rp, Model)"><span>@rp.GetXmlProperty("genxml/textbox/manufacturer")</span>@ProductName(rp)</a></h2>

                                    <div class="flags">
                                        @if (product.IsOnSale)
                                        {
                                            <span class="onsaleflag">@ResourceKey("ProductView.onsaleflag")</span>
                                        }
                                        @if (!product.IsInStock)
                                        {
                                            <span class="outofstockflag">@ResourceKey("ProductView.outofstockflag")</span>
                                        }
                                    </div>

                                </div>

                            </div>
                        }
                    </div>
                </div>
            }
            <div id="tab-6" class="tab-content tab-hide">
                @if (@info.GetXmlProperty("genxml/lang/genxml/edt/txtedit5") != "")
                {
                    @HtmlOf(info, "genxml/lang/genxml/edt/txtedit5")
                }
                else
                {
                    <P>No Videos currently available for this product</P>
                }
            </div>
            @if (isBroker)
            {
                <div id="tab-7" class="tab-content tab-hide">
                    @if (@info.GetXmlProperty("genxml/lang/genxml/edt/txtedit2") != "")
                    {
                        @HtmlOf(info, "genxml/lang/genxml/edt/txtedit2")
                    }
                    else
                    {
                        <p>No Firmware currently available for this product</p>
                    }
                </div>
            }
            @if (isBroker || isReseller)
            {
                <div id="tab-8" class="tab-content tab-hide">
                    @if (@info.GetXmlProperty("genxml/lang/genxml/edt/txtedit3") != "")
                    {
                        @HtmlOf(info, "genxml/lang/genxml/edt/txtedit3")
                    }
                    else
                    {
                        <p>No User Guides currently available for this product</p>
                    }
                </div>
            }
        </div>
    </div>

    @*Back/Return Buttons*@
    <div class="eds_box eds_box_2" style="text-align: center; clear: both;">
        <div class="col-sm-12">
            <a class="eds_btn eds_btnLarge" href="javascript:history.back()">Back</a>
            <a class="eds_btn eds_btnLarge" href="/tabid/@tabid/Default.aspx">Storefront</a>
        </div>
    </div>
</div>

